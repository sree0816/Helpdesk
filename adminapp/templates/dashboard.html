{% extends "homeadmin.html" %}
{% load static %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .kpi-container { display: flex; gap: 20px; margin-bottom: 40px; }
        .kpi-box {
            flex: 1;
            background: #f4f4f4;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .charts { display: flex; gap: 40px; flex-wrap: wrap; }
        canvas { background: #fff; padding: 10px; border-radius: 10px; width: 100%; }
    </style>
</head>
<body>

<h1>Admin Dashboard</h1>

<div class="kpi-container">
    <div class="kpi-box">
        <h3>Total Tickets</h3>
        <p>{{ total_tickets }}</p>
    </div>
    <div class="kpi-box">
        <h3>Open Tickets</h3>
        <p>{{ open_tickets }}</p>
    </div>
    <div class="kpi-box">
        <h3>Closed Tickets</h3>
        <p>{{ closed_tickets }}</p>
    </div>
    <div class="kpi-box">
        <h3>Pending Tickets</h3>
        <p>{{ pending_tickets }}</p>
    </div>
</div>

{% if avg_resolution_time %}
<p><strong>Average Resolution Time:</strong> {{ avg_resolution_time }}</p>
{% endif %}

<div class="charts">
    <div style="width: 45%;">
        <h3>Tickets by Status</h3>
        <canvas id="statusChart"></canvas>
    </div>

    <div style="width: 45%;">
        <h3>Tickets Closed per Agent</h3>
        <canvas id="agentChart"></canvas>
    </div>
</div>

<script>
    const statuses = {{ status_counts_json|safe }};
    const agents = {{ agent_performance_json|safe }};

    // Ticket Status Chart
    const statusLabels = statuses.map(item => item.status);
    const statusCounts = statuses.map(item => item.count);

    new Chart(document.getElementById('statusChart'), {
        type: 'pie',
        data: {
            labels: statusLabels,
            datasets: [{
                data: statusCounts,
                backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56', '#4CAF50']
            }]
        }
    });

    // Agent Performance Chart
    const agentNames = agents.map(a => a.assigned_agent__name);
    const closedCounts = agents.map(a => a.closed_count);

    new Chart(document.getElementById('agentChart'), {
        type: 'bar',
        data: {
            labels: agentNames,
            datasets: [{
                label: 'Tickets Closed',
                data: closedCounts,
                backgroundColor: '#4CAF50'
            }]
        },
        options: {
            scales: { y: { beginAtZero: true } }
        }
    });
</script>

</body>
</html>
{% endblock %}
